import{d as S}from"./chunk-PPGZATS7.js";import{Da as g,Fb as w,Gb as N,Ha as y,Hb as O,Ob as P,P as u,Sa as b,T as h,Ta as r,Ua as s,Va as C,Ya as E,ab as I,bb as p,cb as c,ib as M,jb as x,m,q as f,ta as o,xa as l,y as v}from"./chunk-SRUSGTWF.js";var d=class i{constructor(t){this.http=t}getUpcomingInGermany(t){if(t.toUpperCase()==="TESTBAND")return m([{datetime:new Date().toISOString(),venue:{country:"Germany",latitude:"52.5200",longitude:"13.4050",name:"Berlin Arena"}}]);let e=`https://rest.bandsintown.com/artists/${encodeURIComponent(t)}/events?app_id=test`;return this.http.get(e).pipe(f(n=>(n||[]).filter(a=>a.venue.country==="Germany"&&this.isWithinNextThreeMonths(a.datetime))),v(()=>m([])))}isWithinNextThreeMonths(t){let e=new Date(t),n=new Date,a=new Date(n);return a.setMonth(n.getMonth()+3),e>=n&&e<=a}static \u0275fac=function(e){return new(e||i)(h(P))};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};function T(i,t){if(i&1&&(r(0,"div",3)(1,"h3"),p(2),s(),r(3,"p"),p(4),M(5,"date"),s(),r(6,"p"),p(7),s()()),i&2){let e=E();o(2),c(e.selectedEvent.venue.name),o(2),c(x(5,3,e.selectedEvent.datetime,"longDate")),o(3),c(e.selectedEvent.venue.country)}}var D=class i{constructor(t,e){this.route=t;this.events=e}band="";map;selectedEvent;ngOnInit(){this.route.paramMap.subscribe(t=>{this.band=t.get("band")??"",this.selectedEvent=void 0,this.map&&this.map.eachLayer(e=>{e instanceof L.Marker&&this.map?.removeLayer(e)}),this.loadEvents()})}ngAfterViewInit(){this.loadLeaflet().then(()=>{this.map=L.map("map").setView([51.1657,10.4515],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(this.map)})}loadEvents(){this.band&&this.events.getUpcomingInGermany(this.band).subscribe(t=>{if(this.map){for(let e of t){let n=parseFloat(e.venue.latitude),a=parseFloat(e.venue.longitude);!isNaN(n)&&!isNaN(a)&&L.marker([n,a]).bindPopup(`${e.venue.name}`).addTo(this.map)}if(t.length>0){this.selectedEvent=t[0];let e=parseFloat(this.selectedEvent.venue.latitude),n=parseFloat(this.selectedEvent.venue.longitude);!isNaN(e)&&!isNaN(n)&&this.map.flyTo([e,n],10,{animate:!0,duration:1.5})}}})}loadLeaflet(){return new Promise(t=>{if(typeof L<"u"){t();return}let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e);let n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.onload=()=>t(),document.body.appendChild(n)})}static \u0275fac=function(e){return new(e||i)(l(S),l(d))};static \u0275cmp=g({type:i,selectors:[["app-band-concert-map"]],decls:5,vars:4,consts:[[1,"container"],["id","map",1,"map"],["class","info",4,"ngIf"],[1,"info"]],template:function(e,n){e&1&&(r(0,"h2"),p(1),s(),r(2,"div",0),C(3,"div",1),y(4,T,8,6,"div",2),s()),e&2&&(o(),c(n.band),o(),I("show-info",n.selectedEvent),o(2),b("ngIf",n.selectedEvent))},dependencies:[O,w,N],styles:[".container[_ngcontent-%COMP%]{position:relative;width:100%;height:70vh;display:flex;overflow:hidden}.map[_ngcontent-%COMP%]{flex:1 0 100%;height:70vh;border:2px solid #333;transition:transform .5s ease}.info[_ngcontent-%COMP%]{flex:1 0 50%;padding:1rem;background:#fff;transform:translate(100%);opacity:0;transition:transform .5s ease,opacity .5s ease}.container.show-info[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{transform:translate(-50%)}.container.show-info[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{transform:translate(0);opacity:1}"]})};export{D as BandConcertMapComponent};
